<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>HomeController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=2;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Jacoco Coverage Report</a> &gt; <a href="index.source.html" class="el_package">controllers</a> &gt; <span class="el_source">HomeController.java</span></div><h1>HomeController.java</h1><pre class="source lang-java linenums">package controllers;

import models.*;

import play.mvc.*;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import java.util.Collections;
import java.util.concurrent.CompletableFuture;
import java.util.concurrent.CompletionStage;
import java.util.stream.Collectors;

import javax.inject.Inject;
import java.io.IOException;

import play.api.libs.json.Json;
import play.libs.ws.*;

/**
 * This controller contains an action to handle HTTP requests to the
 * application's home page.
 *  @author Saghana Mahesh Sarma
 *  @author Sumit Ramesh Bhiungade
 *  @author Jai Sahni
 */
public class HomeController extends Controller implements WSBodyReadables, WSBodyWritables {
    private final WSClient ws;
<span class="fc" id="L29">    private static String endpoint = &quot;https://api.pushshift.io/reddit/search&quot;;</span>

    @Inject
<span class="fc" id="L32">    public HomeController(WSClient ws) {</span>
<span class="fc" id="L33">        this.ws = ws;</span>
<span class="fc" id="L34">    }</span>

   /**
     * An action that renders an HTML page with the index page . The configuration
     * in the &lt;code&gt;routes&lt;/code&gt; file means that this method will be called when
     * the application receives a &lt;code&gt;GET&lt;/code&gt; request with a path of
     * &lt;code&gt;/&lt;/code&gt;.
     *   @author Saghana Mahesh Sarma
     *   @author Sumit Ramesh Bhiungade
     *   @author Jai Sahni
     */
    public CompletableFuture&lt;Result&gt; index(Http.Request request) {
<span class="fc" id="L46">        var sessionData = request.session().get(&quot;searchedTerms&quot;);</span>

<span class="pc bpc" id="L48" title="1 of 2 branches missed.">        if (!sessionData.isPresent()) {</span>
<span class="fc" id="L49">            return CompletableFuture.supplyAsync(() -&gt; ok(views.html.index.render(new ArrayList&lt;QuerySearchResult&gt;())));</span>
        } else {
<span class="nc" id="L51">            var post = Arrays</span>
<span class="nc" id="L52">                .stream(sessionData.get().split(&quot;,&quot;))</span>
<span class="nc bnc" id="L53" title="All 2 branches missed.">                .filter(e -&gt; !e.isEmpty())</span>
<span class="nc" id="L54">                .map(k -&gt; k.toLowerCase().trim())</span>
<span class="nc" id="L55">                .distinct()</span>
<span class="nc" id="L56">                .limit(10)</span>
<span class="nc" id="L57">                .parallel()</span>
<span class="nc" id="L58">                .map(CacheManager.GetCache(ws, endpoint)::GetTrimmedSearchResult)</span>
<span class="nc" id="L59">                .collect(Collectors.toList());</span>

<span class="nc" id="L61">            var arrPost = post.toArray(new CompletableFuture[post.size()]);</span>
<span class="nc" id="L62">            return CompletableFuture</span>
<span class="nc" id="L63">                .allOf(arrPost)</span>
<span class="nc" id="L64">                .thenApply(v -&gt; {</span>
                    // reverse post order to show latest posts first &gt;
<span class="nc" id="L66">                    Collections.reverse(post);</span>
<span class="nc" id="L67">                    return post</span>
<span class="nc" id="L68">                        .stream()</span>
<span class="nc" id="L69">                        .map(CompletableFuture::join)</span>
<span class="nc" id="L70">                        .collect(Collectors.toList());</span>
                })
<span class="nc" id="L72">                .thenApply(res -&gt; ok(views.html.index.render(res)));</span>
        }
    }
 /**
     * This controller method will be used to take in a search term, perform a lookup, add that to cache and then redirect to index page.
     * @author Saghana Mahesh Sarma
     * @author Sumit Ramesh Bhiungade
     * @author Jai Sahni
     * @param query The search term for which we need to fetch posts from Reddit
     * @param request {@link play.mvc.Http.Request}
     * @return {@link Result}
     * */
    public Result search(String query, Http.Request request) {
<span class="nc" id="L85">        var currentSession = request.session().get(&quot;searchedTerms&quot;).orElse(&quot;&quot;);</span>
<span class="nc" id="L86">        currentSession += &quot;,&quot; + query;</span>

<span class="nc" id="L88">        return redirect(&quot;/&quot;).addingToSession(request, &quot;searchedTerms&quot;, currentSession);</span>
    }
   /**
     * This controller method will be used to take in a user id and helps in retrieving owner information
     * and then return a new view
     * @author Saghana Mahesh Sarma
     * @param user The user id to get the details of the author of a reddit
     * @return {@link Result}
     * */
    public CompletableFuture&lt;Result&gt; searchUser(String user, Http.Request request) {
<span class="nc" id="L98">        return CacheManager</span>
<span class="nc" id="L99">            .GetCache(ws, endpoint)</span>
<span class="nc" id="L100">            .GetUserInfo((user))</span>
<span class="nc" id="L101">            .thenApply((result) -&gt; ok(views.html.profile.render(result)));</span>
    }
  /**
     * This controller method will be used to take in a subreddit and helps in retrieving reddit posts under that particular subreddit
     * and then return a new view
     * @author Jai Sahni
     * @param subreddit The subreddit for which the reddits need to be fetched.
     * @return {@link Result}
     * */
    public CompletableFuture&lt;Result&gt; searchThread(String subreddit, Http.Request request) {
<span class="nc" id="L111">        return CacheManager</span>
<span class="nc" id="L112">            .GetCache(ws, endpoint)</span>
<span class="nc" id="L113">            .GetThreadInfo((subreddit))</span>
<span class="nc" id="L114">            .thenApply((result) -&gt; ok(views.html.thread.render(result)));</span>
    }
 /**
     * This controller method will be used to perform word stats on a given search query .
     * and then return a new view
     * @author Sumit Ramesh Bhiungade
     * @param query The query on which the word stats need to be performed
     * @return {@link Result}
     * */
    public CompletableFuture&lt;Result&gt; searchStats(String query, Http.Request request) {
<span class="nc" id="L124">        return CacheManager</span>
<span class="nc" id="L125">            .GetCache(ws, endpoint)</span>
<span class="nc" id="L126">            .GetTrimmedSearchResult((query))</span>
<span class="nc" id="L127">            .thenApply((result) -&gt; ok(views.html.stats.render(result)));</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.2.201808211720</span></div></body></html>